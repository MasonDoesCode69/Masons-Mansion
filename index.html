<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mason‚Äôs Mansion | V3 Ultimate</title>
    <style>
        :root {
            --bg: #050505;
            --panel: rgba(15, 15, 15, 0.85);
            --card: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.1);
            --text: #ffffff;
            --muted: #888888;
            --accent: #00f2ff;
            --glow: rgba(0, 242, 255, 0.4);
            --font-main: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        /* RESET & BASE */
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }
        
        body {
            font-family: var(--font-main);
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            cursor: none;
            user-select: none;
        }

        /* ANIMATED BACKGROUND */
        #bg-canvas {
            position: fixed;
            inset: 0;
            z-index: -1;
            opacity: 0.4;
        }

        /* CURSOR SYSTEM */
        #cursor-core {
            position: fixed; width: 8px; height: 8px; background: var(--accent);
            border-radius: 50%; pointer-events: none; z-index: 99999;
            box-shadow: 0 0 15px var(--accent);
        }
        #cursor-glow {
            position: fixed; width: 300px; height: 300px;
            background: radial-gradient(circle, var(--glow) 0%, transparent 70%);
            border-radius: 50%; pointer-events: none; z-index: 99998;
            transform: translate(-50%, -50%); transition: width 0.3s, height 0.3s;
        }

        /* LOGIN / OVERLAYS */
        .overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            display: flex; align-items: center; justify-content: center; z-index: 100000;
            backdrop-filter: blur(20px); transition: opacity 0.5s;
        }
        .login-box {
            background: var(--panel); border: 1px solid var(--border);
            padding: 40px; border-radius: 30px; width: 380px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .login-box h1 { font-size: 1.5rem; letter-spacing: 5px; margin-bottom: 20px; color: var(--accent); }
        .login-box input {
            width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border);
            padding: 15px; border-radius: 15px; color: white; margin-bottom: 15px; text-align: center;
        }
        .login-box button {
            width: 100%; padding: 15px; border-radius: 15px; border: none;
            background: var(--accent); color: #000; font-weight: 700; cursor: pointer;
        }
        .error-msg { color: #ff4444; font-size: 12px; margin-top: 10px; display: none; }

        /* DESKTOP UI */
        #desktop {
            height: 100vh; display: flex; flex-direction: column; position: relative;
        }

        header {
            height: 60px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px; border-bottom: 1px solid var(--border); background: var(--panel);
            backdrop-filter: blur(10px); z-index: 10;
        }
        .logo { font-weight: 900; letter-spacing: 3px; font-size: 18px; }
        .logo span { color: var(--accent); }

        /* WINDOW SYSTEM */
        .window {
            position: absolute; background: var(--panel); border: 1px solid var(--border);
            border-radius: 15px; display: flex; flex-direction: column; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4); min-width: 300px; min-height: 200px;
            backdrop-filter: blur(15px);
        }
        .window-header {
            padding: 12px 18px; background: rgba(255,255,255,0.05); display: flex;
            justify-content: space-between; align-items: center; cursor: move;
        }
        .window-title { font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
        .window-controls { display: flex; gap: 8px; }
        .control-dot { width: 12px; height: 12px; border-radius: 50%; cursor: pointer; }
        .dot-close { background: #ff5f56; }
        .dot-max { background: #27c93f; }
        .window-content { flex-grow: 1; overflow: auto; position: relative; }

        /* APP-SPECIFIC STYLES */
        .sidebar-list { padding: 15px; }
        .nav-item {
            padding: 12px; margin-bottom: 8px; border-radius: 10px; background: var(--card);
            border: 1px solid transparent; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; gap: 10px;
        }
        .nav-item:hover { border-color: var(--accent); background: rgba(255,255,255,0.08); }
        .nav-item i { font-size: 18px; color: var(--accent); }

        /* THEME GRID */
        .theme-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; padding: 15px; }
        .theme-card {
            aspect-ratio: 1; border-radius: 12px; cursor: pointer; display: flex;
            flex-direction: column; align-items: center; justify-content: center;
            border: 1px solid var(--border); font-size: 10px; transition: 0.2s;
        }
        .theme-card:hover { transform: translateY(-3px); border-color: var(--accent); }

        /* IFRAME PLAYER */
        #game-frame { width: 100%; height: 100%; border: none; background: #000; }

        /* TASKBAR */
        #taskbar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            height: 60px; background: var(--panel); border: 1px solid var(--border);
            border-radius: 20px; display: flex; align-items: center; padding: 0 15px;
            gap: 15px; backdrop-filter: blur(20px); z-index: 1000;
        }
        .task-icon {
            width: 40px; height: 40px; border-radius: 10px; background: var(--card);
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            transition: 0.3s; font-size: 20px;
        }
        .task-icon:hover { background: var(--accent); color: #000; transform: scale(1.1); }

        /* UTILS */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .p-20 { padding: 20px; }
    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>
    <div id="cursor-core"></div>
    <div id="cursor-glow"></div>

    <div id="auth-overlay" class="overlay">
        <div class="login-box">
            <h1>MASON<span>'S</span> MANSION</h1>
            <input type="password" id="entry-pass" placeholder="ACCESS KEY">
            <button onclick="System.auth()">INITIALIZE</button>
            <p id="auth-error" class="error-msg">INVALID SECURITY KEY</p>
        </div>
    </div>

    <div id="desktop" class="hidden">
        <header>
            <div class="logo">MASON<span>MANSION</span></div>
            <div id="clock">00:00:00</div>
            <div id="user-status">GUEST</div>
        </header>

        <div id="window-root" style="flex-grow: 1; position: relative;"></div>

        <div id="taskbar">
            <div class="task-icon" onclick="WindowManager.create('games')">üéÆ</div>
            <div class="task-icon" onclick="WindowManager.create('settings')">‚öôÔ∏è</div>
            <div class="task-icon" onclick="WindowManager.create('browser')">üåê</div>
            <div class="task-icon" onclick="WindowManager.create('themes')">üé®</div>
            <div class="task-icon" onclick="WindowManager.create('admin')">üîê</div>
        </div>
    </div>

    <script>
        /**
         * MASON'S MANSION CORE ENGINE
         * Total Lines Target: Expanding Logic for Longevity
         */

        const CONFIG = {
            keys: { user: "Honey", vip: "VIP67", owner: "masononly69" },
            defaultGames: [
                { name: "Gladihoppers", url: "https://xfrapo.github.io/projectroyal/projects/gladihoppers/index.html", icon: "‚öîÔ∏è" },
                { name: "BitLife", url: "https://3kh0.github.io/bitlife/", icon: "üë∂" },
                { name: "Minecraft", url: "https://precisionclient.pages.dev/", icon: "‚õèÔ∏è" },
                { name: "Proxy (UV)", url: "https://ultraviolet-node.netlify.app/", icon: "üõ°Ô∏è" }
            ],
            themes: [
                { name: "Cyberpunk", bg: "#050505", accent: "#00f2ff", glow: "rgba(0,242,255,0.3)" },
                { name: "Lava", bg: "#0f0505", accent: "#ff4400", glow: "rgba(255,68,0,0.3)" },
                { name: "Matrix", bg: "#000a00", accent: "#00ff44", glow: "rgba(0,255,68,0.3)" },
                { name: "Royal", bg: "#0a0015", accent: "#bd00ff", glow: "rgba(189,0,255,0.3)" },
                { name: "Gold", bg: "#0e0e08", accent: "#ffcc00", glow: "rgba(255,204,0,0.3)" }
            ]
        };

        // SYSTEM STATE
        let state = {
            isUnlocked: false,
            rank: 'guest',
            activeThemes: [...CONFIG.themes],
            userGames: JSON.parse(localStorage.getItem('mm_games')) || [...CONFIG.defaultGames]
        };

        const System = {
            init() {
                this.bindEvents();
                this.initBackground();
                this.updateClock();
                setInterval(() => this.updateClock(), 1000);
            },

            bindEvents() {
                // Cursor Tracking
                document.addEventListener('mousemove', (e) => {
                    const core = document.getElementById('cursor-core');
                    const glow = document.getElementById('cursor-glow');
                    core.style.left = e.clientX + 'px';
                    core.style.top = e.clientY + 'px';
                    glow.style.left = e.clientX + 'px';
                    glow.style.top = e.clientY + 'px';
                });

                // Panic Key (Esc)
                document.addEventListener('keydown', (e) => {
                    if (e.key === "Escape") {
                        window.location.href = "https://www.google.com/search?q=educational+resources";
                    }
                });
            },

            auth() {
                const input = document.getElementById('entry-pass').value;
                const err = document.getElementById('auth-error');

                if (input === CONFIG.keys.owner) {
                    state.rank = 'OWNER';
                    this.launch();
                } else if (input === CONFIG.keys.vip) {
                    state.rank = 'VIP';
                    this.launch();
                } else if (input === CONFIG.keys.user) {
                    state.rank = 'MEMBER';
                    this.launch();
                } else {
                    err.style.display = 'block';
                }
            },

            launch() {
                document.getElementById('auth-overlay').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('auth-overlay').classList.add('hidden');
                    document.getElementById('desktop').classList.remove('hidden');
                    document.getElementById('user-status').innerText = state.rank;
                    WindowManager.create('games');
                }, 500);
            },

            updateClock() {
                const now = new Date();
                document.getElementById('clock').innerText = now.toLocaleTimeString();
            },

            initBackground() {
                const canvas = document.getElementById('bg-canvas');
                const ctx = canvas.getContext('2d');
                let w, h, particles = [];

                const resize = () => {
                    w = canvas.width = window.innerWidth;
                    h = canvas.height = window.innerHeight;
                };

                class Particle {
                    constructor() {
                        this.x = Math.random() * w;
                        this.y = Math.random() * h;
                        this.size = Math.random() * 2;
                        this.speedX = Math.random() * 0.5 - 0.25;
                        this.speedY = Math.random() * 0.5 - 0.25;
                    }
                    update() {
                        this.x += this.speedX;
                        this.y += this.speedY;
                        if (this.x > w) this.x = 0;
                        if (this.x < 0) this.x = w;
                        if (this.y > h) this.y = 0;
                        if (this.y < 0) this.y = h;
                    }
                    draw() {
                        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent');
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }

                resize();
                for(let i=0; i<100; i++) particles.push(new Particle());

                const animate = () => {
                    ctx.clearRect(0,0,w,h);
                    particles.forEach(p => { p.update(); p.draw(); });
                    requestAnimationFrame(animate);
                };
                window.onresize = resize;
                animate();
            }
        };

        const WindowManager = {
            zIndex: 100,

            create(type, data = null) {
                const id = 'win-' + Math.random().toString(36).substr(2, 9);
                const win = document.createElement('div');
                win.className = 'window';
                win.id = id;
                win.style.left = '100px';
                win.style.top = '100px';
                win.style.zIndex = ++this.zIndex;

                let content = '';
                let title = type.toUpperCase();

                if (type === 'games') {
                    win.style.width = '400px';
                    win.style.height = '500px';
                    content = `<div class="sidebar-list">
                        ${state.userGames.map((g, i) => `
                            <div class="nav-item" onclick="WindowManager.create('player', {url:'${g.url}', name:'${g.name}'})">
                                <i>${g.icon}</i>
                                <span>${g.name}</span>
                            </div>
                        `).join('')}
                    </div>`;
                }

                if (type === 'player') {
                    title = data.name;
                    win.style.width = '80%';
                    win.style.height = '70%';
                    win.style.left = '10%';
                    win.style.top = '10%';
                    content = `<iframe id="game-frame" src="${data.url}" allow="autoplay; fullscreen"></iframe>`;
                }

                if (type === 'themes') {
                    win.style.width = '350px';
                    content = `<div class="theme-grid">
                        ${state.activeThemes.map(t => `
                            <div class="theme-card" style="background:${t.bg}; color:${t.accent}" onclick="WindowManager.applyTheme('${t.name}')">
                                <strong>${t.name}</strong>
                            </div>
                        `).join('')}
                    </div>`;
                }

                if (type === 'admin') {
                    if (state.rank !== 'OWNER') {
                        content = `<div class="p-20">Access Denied. Owner level required.</div>`;
                    } else {
                        content = `<div class="p-20">
                            <h3>ADD GAME</h3>
                            <input id="new-g-name" class="login-box" style="width:100%; margin:10px 0;" placeholder="Game Name">
                            <input id="new-g-url" class="login-box" style="width:100%; margin:10px 0;" placeholder="URL">
                            <button onclick="WindowManager.saveGame()" style="width:100%; padding:10px; background:var(--accent); border:none; border-radius:5px;">SAVE TO CLOUD</button>
                        </div>`;
                    }
                }

                win.innerHTML = `
                    <div class="window-header" onmousedown="WindowManager.dragStart(event, '${id}')">
                        <div class="window-title">${title}</div>
                        <div class="window-controls">
                            <div class="control-dot dot-close" onclick="document.getElementById('${id}').remove()"></div>
                        </div>
                    </div>
                    <div class="window-content">${content}</div>
                `;

                document.getElementById('window-root').appendChild(win);
            },

            applyTheme(name) {
                const t = state.activeThemes.find(x => x.name === name);
                const root = document.documentElement;
                root.style.setProperty('--bg', t.bg);
                root.style.setProperty('--accent', t.accent);
                root.style.setProperty('--glow', t.glow);
            },

            dragStart(e, id) {
                const win = document.getElementById(id);
                win.style.zIndex = ++this.zIndex;
                let pos1 = 0, pos2 = 0, pos3 = e.clientX, pos4 = e.clientY;

                const dragMove = (e) => {
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    win.style.top = (win.offsetTop - pos2) + "px";
                    win.style.left = (win.offsetLeft - pos1) + "px";
                };

                const dragEnd = () => {
                    document.onmouseup = null;
                    document.onmousemove = null;
                };

                document.onmousemove = dragMove;
                document.onmouseup = dragEnd;
            },

            saveGame() {
                const n = document.getElementById('new-g-name').value;
                const u = document.getElementById('new-g-url').value;
                if(n && u) {
                    state.userGames.push({name: n, url: u, icon: "‚≠ê"});
                    localStorage.setItem('mm_games', JSON.stringify(state.userGames));
                    alert("Game Saved. Reopen Game Menu to see it.");
                }
            }
        };

        // RUN SYSTEM
        System.init();

    </script>
</body>
</html>
